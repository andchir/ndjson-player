/**
 * Author : A.Lepe (dev@alepe.com)
 * License: MIT
 * Version: 0.1.8
 * Updated: 2022-05-09
 * Content: ndjson-ui.min.js (Minimized)
 */

class NDJPlayer{player;options;ui;constructor(e,t,o){const s=this;s.options=Object.assign({controls:!1,resize:!0,onaction:(e,t,o)=>{},onplay:e=>{},onstop:e=>{}},o||{}),this._create(t),this.player=new NdJsonPlayer(e,t,s.options,{onstart:function(e){s._adjustSize(),void 0!==s.options.onstart&&s.options.onstart(e)},onload:function(e){void 0!==s.options.onload&&s.options.onload(e)},onrender:function(e){s._onUpdate(e),void 0!==s.options.onrender&&s.options.onrender(e)},onplay:function(e){s.ui.play.show=!1,s.ui.step.disabled||(s.ui.step.show=!1),s.ui.pause.show=!0,s.options.onplay(e)},onstop:function(e){s.ui.play.show=!0,s.ui.step.disabled||(s.ui.step.show=!0),s.ui.pause.show=!1,s.options.onstop(e)},onfinish:function(e){},onerror:function(e){console.log(e)}})}_onUpdate(e){const t=this;if(void 0!==t.ui){if(void 0!==t.ui.frames&&(t.ui.frames.text=t.player.currentFrame()+1+"/"+t.player.totalFrames()),void 0!==t.ui.lapse){let o="";const s=t.player._startTimeStamp&&void 0!==e.ts,a=void 0!==e.t,n=t.player._totTime>0;e.d&&(o=e.d+" "),s?o+=t._formatMillis(e.ts-t.player._startTimeStamp):a&&(o+=e.t.indexOf(":")>0?e.t:t._fmtTime(e.t)),n&&(o+="/"+t.player.totalTime()),t.ui.lapse.text=o}void 0!==t.ui.progress&&(t.ui.progress.value=(t.player.currentFrame()+1)/t.player.totalFrames()*100)}}_adjustSize(){if(this.options.resize){let e=this.player.wrapper,t=e.parent();if(e.clientHeight>t.clientHeight){let o=this.player.canvas.height/this.player.canvas.width,s=1/o;this.player.canvas.height=t.clientHeight-(this.options.controls?e.querySelector(".panel").clientHeight:0),this.player.canvas.width=t.clientWidth*(o<1?o:s)}}}_create(e){const t=this,o=m2d2.load();t.ui=o(e,t._getUI(e)),["thumb","play","step","pause","stop","lapse","progress","frames","fullscreen"].forEach((e=>{t.ui[e]=t.ui.panel[e]}))}_getUI(e){const t=this;let o={html:e.innerHTML||""};if(t.options.controls){const e="full"===t.options.controls,s="common"===t.options.controls;o=this._getBasicUI(),e&&(o.panel.stop.show=!0,o.panel.lapse.show=!0,o.panel.step.disabled=!1,o.panel.frames.show=!0,o.panel.fullscreen.show=!0),s&&(o.panel.frames.show=!0)}this.options.controls;let s=e instanceof Node?e:document.querySelector(e);if(s){s.querySelector("canvas")||(o=Object.assign({canvas:""},o))}else console.log("Root element: "+e+" was not found in document"),o=Object.assign({canvas:""},o);return o}_getBasicUI(){const e=this;return document.addEventListener("fullscreenchange",(t=>{const o=e.player.wrapper;document.fullscreenElement?o.classList.add("fullscreen"):o.classList.remove("fullscreen")})),{caption:"",panel:{tagName:"div",className:"panel",thumb:{tagName:"figure",className:"thumb",show:!1,img:{src:""},caption:{tagName:"figCaption",className:"caption",show:!1}},play:{tagName:"a",className:"play",title:"Play",href:"#",show:!0,onclick:function(){return e.ui.onaction("play",e.player,e),e.player.play(),!1}},pause:{tagName:"a",className:"pause",title:"Pause",href:"#",show:!1,onclick:function(){return e.ui.onaction("pause",e.player,e),e.player.pause(),!1}},step:{tagName:"a",className:"step",title:"Step",href:"#",disabled:!0,show:!1,onclick:function(){return e.ui.onaction("step",e.player,e),e.player.step(),!1}},stop:{tagName:"a",className:"stop",title:"Stop",href:"#",show:!1,onclick:function(){return e.ui.onaction("stop",e.player,e),e.player.stop(),!1}},lapse:{tagName:"label",className:"lapse",title:"Time elapsed / Time Total",text:"0:00",show:!1},progress:{value:0,max:100,show:!0,onmousemove:function(t){let o=~~(t.offsetX/this.offsetWidth*100),s=e.player.frameAt(e.player.indexAt(o));s?(e.ui.thumb.show=!0,e.ui.thumb.img.src=e.player.frameBase()+(s.th||s.f),e.ui.thumb.img.onload=function(){const t=e.ui.thumb.img.naturalWidth||e.ui.thumb.img.width;e.ui.thumb.style.width=t+"px"},void 0!==s.tc&&(e.ui.thumb.caption=s.tc),e.ui.thumb.style.left=this.offsetLeft+t.offsetX-e.ui.thumb.clientWidth/2+"px"):e.ui.thumb.show=!1},onmouseleave:function(){e.ui.thumb.show=!1},onclick:function(t){let o=~~(t.offsetX/this.offsetWidth*100),s=e.player.indexAt(o);e.player.jumpTo(s),e.ui.onaction("progress",e.player,e)}},frames:{tagName:"label",className:"frames",title:"Current Frame / Total Frames",text:"0",show:!1},fullscreen:{tagName:"a",className:"fullscreen",title:"Full Screen",href:"#",show:!1,onclick:function(t){const o=e.player.wrapper;return o.classList.contains("fullscreen")?(e.ui.onaction("exit-fullscreen",e.player,e),document.exitFullscreen()):(e.ui.onaction("fullscreen",e.player,e),o.requestFullscreen()),!1}}},onaction:function(t,o,s){e.options.onaction(t,o,s)},onplay:function(t){e.options.onplay(t)},onstop:function(t){e.options.onstop(t,uiPlayer)}}}_fmtTime(e){let t=(e=e.toFixed(2)).split(".")[1]||"00";return(~~(e/60)+"").padStart(2,"0")+":"+(~~(e/60%1*60)+"").padStart(2,"0")+"."+t}_formatMillis(e){function t(e,t){return("00"+e).slice(-1*(t||2))}const o=Math.floor(e/1e3/60/60),s=Math.floor(60*(e/1e3/60/60-o)),a=Math.floor(60*(60*(e/1e3/60/60-o)-s)),n=parseInt(e%1e3/100);return t(o)+":"+t(s)+":"+t(a)+"."+t(n,3)}}
//# sourceMappingURL=ndjson-ui.min.js.map
