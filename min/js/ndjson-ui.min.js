/**
 * Author : A.Lepe (dev@alepe.com)
 * License: MIT
 * Version: 0.1.8
 * Updated: 2022-05-10
 * Content: ndjson-ui.min.js (Minimized)
 */

class NDJPlayer{player;options;ui;constructor(e,t,a){const n=this;function s(e){return e.indexOf(".")>0||-1!==e.indexOf("/")}function o(e){return"."===e[0]||"#"===e[0]||null!==document.querySelector(e)}switch(arguments.length){case 2:"Object"===arguments[1].constructor.name&&(a=arguments[1],s(arguments[0])?t=null:(arguments[0]instanceof HTMLElement||o(arguments[0]))&&(t=arguments[0],e=null));break;case 1:switch(!0){case"Object"===arguments[0].constructor.name:a=arguments[0],e=null,t=null;break;case s(arguments[0]):e=arguments[0],t=null,a={};break;case arguments[0]instanceof HTMLElement||o(arguments[0]):t=arguments[0],e=null,a={};break;default:console.log("Unknown parameter was passed to NDJPlayer constructor."),e=null,t=null,a={}}break;case 0:a={}}n.options=Object.assign({controls:!1,resize:!0,onaction:(e,t,a)=>{},onplay:e=>{},onstop:e=>{}},a||{}),this._create(t),this.player=new NdJsonPlayer(e,t,n.options,{onstart:function(e){n._adjustSize(),void 0!==n.options.onstart&&n.options.onstart(e)},onload:function(e){void 0!==n.options.onload&&n.options.onload(e)},onrender:function(e){n._onUpdate(e),void 0!==n.options.onrender&&n.options.onrender(e)},onplay:function(e){n.ui.panel&&(n.ui.play.show=!1,n.ui.step.css.contains("disabled")||(n.ui.step.show=!1),n.ui.pause.show=!0),n.options.onplay(e)},onstop:function(e){n.ui.panel&&(n.ui.play.show=!0,n.ui.step.css.contains("disabled")||(n.ui.step.show=!0),n.ui.pause.show=!1),n.options.onstop(e)},onfinish:function(e){},onerror:function(e){console.log(e)}})}_onUpdate(e){const t=this;if(t.ui){if(t.ui.frames&&(t.ui.frames.text=t.player.currentFrame()+1+"/"+t.player.totalFrames()),t.ui.lapse){let a="";const n=t.player._startTimeStamp&&void 0!==e.ts,s=void 0!==e.t,o=t.player._totTime>0;e.d&&(a=e.d+" "),n?a+=t._formatMillis(e.ts-t.player._startTimeStamp):s&&(a+=e.t.indexOf(":")>0?e.t:t._fmtTime(e.t)),o&&(a+="/"+t.player.totalTime()),t.ui.lapse.text=a}t.ui.progress&&(t.ui.progress.value=(t.player.currentFrame()+1)/t.player.totalFrames()*100)}}_adjustSize(){if(this.options.resize){let e=this.player.wrapper,t=e.parent();if(e.clientHeight>t.clientHeight){let a=this.player.canvas.height/this.player.canvas.width,n=1/a;this.player.canvas.height=t.clientHeight-(this.options.controls?e.querySelector(".panel").clientHeight:0),this.player.canvas.width=t.clientWidth*(a<1?a:n)}}}_create(e){const t=this,a=m2d2.load();t.ui=a(e,t._getUI(e)),t.ui.panel&&["thumb","play","step","pause","stop","lapse","progress","frames","fullscreen"].forEach((e=>{t.ui[e]=t.ui.panel[e]}))}_getUI(e){const t=this;let a={html:e.innerHTML||""};if(t.options.controls&&(a=this._getBasicUI(),"full"===t.options.controls))a.panel.step.css.remove("disabled");this.options.controls;let n=e instanceof Node?e:document.querySelector(e);if(n){n.querySelector("canvas")||(a=Object.assign({canvas:""},a))}else console.log("Root element: "+e+" was not found in document"),a=Object.assign({canvas:""},a);return a}_getBasicUI(){const e=this;return document.addEventListener("fullscreenchange",(t=>{const a=e.player.wrapper;document.fullscreenElement?a.classList.add("fullscreen"):a.classList.remove("fullscreen")})),{caption:"",css:e.options.controls,panel:{tagName:"div",className:"panel",thumb:{tagName:"figure",className:"thumb",img:{src:""},caption:{tagName:"figCaption",className:"caption"}},rec:{tagName:"a",className:"rec",title:"Live",href:"#"},play:{tagName:"a",className:"play",title:"Play",href:"#",onclick:function(){return e.ui.onaction("play",e.player,e),e.player.play(),!1}},pause:{tagName:"a",className:"pause",title:"Pause",href:"#",onclick:function(){return e.ui.onaction("pause",e.player,e),e.player.pause(),!1}},step:{tagName:"a",css:["step","disabled"],title:"Step",href:"#",onclick:function(){return e.ui.onaction("step",e.player,e),e.player.step(),!1}},stop:{tagName:"a",className:"stop",title:"Stop",href:"#",onclick:function(){return e.ui.onaction("stop",e.player,e),e.player.stop(),!1}},lapse:{tagName:"label",className:"lapse",title:"Time elapsed / Time Total",text:"0:00"},live:{tagName:"label",className:"live",text:"Live Feed"},progress:{value:0,max:100,onmousemove:function(t){let a=~~(t.offsetX/this.offsetWidth*100),n=e.player.frameAt(e.player.indexAt(a));n?(e.ui.thumb.show=!0,e.ui.thumb.img.src=e.player.frameBase()+(n.th||n.f),e.ui.thumb.img.onload=function(){const t=e.ui.thumb.img.naturalWidth||e.ui.thumb.img.width;e.ui.thumb.style.width=t+"px"},void 0!==n.tc&&(e.ui.thumb.caption=n.tc),e.ui.thumb.style.left=this.offsetLeft+t.offsetX-e.ui.thumb.clientWidth/2+"px"):e.ui.thumb.show=!1},onmouseleave:function(){e.ui.thumb.show=!1},onclick:function(t){let a=~~(t.offsetX/this.offsetWidth*100),n=e.player.indexAt(a);e.player.jumpTo(n),e.ui.onaction("progress",e.player,e)}},frames:{tagName:"label",className:"frames",title:"Current Frame / Total Frames",text:"0"},fullscreen:{tagName:"a",className:"fullscreen",title:"Full Screen",href:"#",onclick:function(t){const a=e.player.wrapper;return a.classList.contains("fullscreen")?(e.ui.onaction("exit-fullscreen",e.player,e),document.exitFullscreen()):(e.ui.onaction("fullscreen",e.player,e),a.requestFullscreen()),!1}}},onaction:function(t,a,n){e.options.onaction(t,a,n)},onplay:function(t){e.options.onplay(t)},onstop:function(t){e.options.onstop(t,uiPlayer)}}}_fmtTime(e){let t=(e=e.toFixed(2)).split(".")[1]||"00";return(~~(e/60)+"").padStart(2,"0")+":"+(~~(e/60%1*60)+"").padStart(2,"0")+"."+t}_formatMillis(e){function t(e,t){return("00"+e).slice(-1*(t||2))}const a=Math.floor(e/1e3/60/60),n=Math.floor(60*(e/1e3/60/60-a)),s=Math.floor(60*(60*(e/1e3/60/60-a)-n)),o=parseInt(e%1e3/100);return t(a)+":"+t(n)+":"+t(s)+"."+t(o,3)}}
//# sourceMappingURL=ndjson-ui.min.js.map
