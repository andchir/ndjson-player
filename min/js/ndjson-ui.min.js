/**
 * Author : A.Lepe (dev@alepe.com)
 * License: MIT
 * Version: 0.1.8
 * Updated: 2022-04-26
 * Content: ndjson-ui.min.js (Minimized)
 */

class NDJPlayer{ndjp;options;ui;onAction;constructor(t,o,e,n){const s=this;this.options=Object.assign({controls:!1,resize:!0},e||{}),this.onAction=n||function(){},this._create(o),this.ndjp=new NdJsonPlayer(t,o,e,(function(t){s._adjustSize(),void 0!==s.options.onstart&&s.options.onstart(t)}),(function(t){void 0!==s.options.onload&&s.options.onload(t)}),(function(t){s._onUpdate(t),void 0!==s.options.onrender&&s.options.onrender(t)}),(function(t){}),(function(t){}))}_onUpdate(t){const o=this;if(void 0!==o.ui&&void 0!==o.ui.controls){if(void 0!==o.ui.controls.frames&&(o.ui.controls.frames.text=o.ndjp.currentFrame()+1+"/"+o.ndjp.totalFrames()),void 0!==o.ui.controls.lapse){let e="";const n=o.ndjp._startTimeStamp&&void 0!==t.ts,s=void 0!==t.t,i=o.ndjp._totTime>0;t.d&&(e=t.d+" "),n?e+=o._formatMillis(t.ts-o.ndjp._startTimeStamp):s&&(e+=t.t.indexOf(":")>0?t.t:o._fmtTime(t.t)),i&&(e+="/"+o.ndjp.totalTime()),o.ui.controls.lapse.text=e}void 0!==o.ui.controls.progress&&(o.ui.controls.progress.value=(o.ndjp.currentFrame()+1)/o.ndjp.totalFrames()*100)}}_adjustSize(){if(this.options.resize){let t=this.ndjp.player,o=this.ndjp.player.parentElement;if(t.clientHeight>o.clientHeight){let e=this.ndjp.canvas.height/this.ndjp.canvas.width,n=1/e;this.ndjp.canvas.height=o.clientHeight-(this.options.controls?t.querySelector(".controls").clientHeight:0),this.ndjp.canvas.width=o.clientWidth*(e<1?e:n)}}}_create(t){this.ui=m2d2(t,this._getUI(t))}_getUI(t){const o=this;let e={html:t.innerHTML||""};const n={tagName:"a",className:"play",show:!0,title:"Play",text:"▶️",href:"#",onclick:function(){return o.onAction("play",o.ndjp,o),o.ndjp.play(),o.ui.controls.play.show=!1,o.ui.controls.pause.show=!0,!1}},s={tagName:"a",className:"pause",show:!1,title:"Pause",text:"⏸️",href:"#",onclick:function(){return o.onAction("pause",o.ndjp,o),o.ndjp.pause(),o.ui.controls.play.show=!0,o.ui.controls.pause.show=!1,!1}},i={tagName:"a",className:"stop",title:"Stop",text:"⏹️",href:"#",onclick:function(){return o.onAction("stop",o.ndjp,o),o.ndjp.stop(),!1}};document.addEventListener("fullscreenchange",(t=>{const e=o.ndjp.player;document.fullscreenElement?e.classList.add("fullscreen"):e.classList.remove("fullscreen")}));const a={tagName:"a",className:"fullscreen",title:"Full Screen",text:"⛶",href:"#",onclick:function(t){const e=o.ndjp.player;return e.classList.contains("fullscreen")?document.exitFullscreen():e.requestFullscreen(),!1}},l={tagName:"label",className:"lapse",show:!0,title:"Time elapsed / Time Total",text:"0:00"},c={tagName:"label",className:"frames",show:!0,title:"Current Frame / Total Frames",text:"0"},r={show:!0,value:0,max:100,onmousemove:function(t){let e=~~(t.offsetX/this.offsetWidth*100),n=o.ndjp.frameAt(o.ndjp.indexAt(e));if(n){o.ui.controls.thumb.show=!0,o.ui.controls.thumb.img.src=o.ndjp.frameBase()+(n.th||n.f),void 0!==n.tc&&(o.ui.controls.thumb.caption=n.tc);let e=o.ui.controls.thumb._node;e.style.left=this.offsetLeft+t.offsetX-e.clientWidth/2+"px"}else o.ui.controls.thumb.show=!1},onmouseleave:function(){o.ui.controls.thumb.show=!1},onclick:function(t){let e=~~(t.offsetX/this.offsetWidth*100),n=o.ndjp.indexAt(e);o.ndjp.step(n),o.onAction("progress",o.ndjp,o)}};if(this.options.controls){const t="full"===this.options.controls,o="common"===this.options.controls;e=this._getBasicUI(),e.controls.play=n,e.controls.pause=s,t&&(e.controls.stop=i),e.controls.lapse=l,e.controls.progress=r,(o||t)&&(e.controls.frames=c),t&&(e.controls.fullscreen=a)}this.options.controls;let p=t instanceof Node?t:document.querySelector(t);if(p){p.querySelector("canvas")||(e=Object.assign({canvas:""},e))}else console.log("Root element: "+t+" was not found in document"),e=Object.assign({canvas:""},e);return e}_getBasicUI(){return{caption:"",controls:{tagName:"div",className:"controls",thumb:{tagName:"figure",className:"thumb",show:!1,img:{src:""},caption:{tagName:"figCaption",className:"caption",show:!1}}}}}_fmtTime(t){let o=(t=t.toFixed(2)).split(".")[1]||"00";return(~~(t/60)+"").padStart(2,"0")+":"+(~~(t/60%1*60)+"").padStart(2,"0")+"."+o}_formatMillis(t){function o(t,o){return("00"+t).slice(-1*(o||2))}const e=Math.floor(t/1e3/60/60),n=Math.floor(60*(t/1e3/60/60-e)),s=Math.floor(60*(60*(t/1e3/60/60-e)-n)),i=parseInt(t%1e3/100);return o(e)+":"+o(n)+":"+o(s)+"."+o(i,3)}}
//# sourceMappingURL=ndjson-ui.min.js.map
