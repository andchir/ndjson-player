/**
 * Author : A.Lepe (dev@alepe.com)
 * License: MIT
 * Version: 0.1.8
 * Updated: 2022-05-09
 * Content: ndjson-ui.min.js (Minimized)
 */

class NDJPlayer{player;options;ui;constructor(e,t,s){const o=this;this.options=Object.assign({controls:!1,resize:!0,onaction:(e,t,s)=>{}},s||{}),this._create(t),this.player=new NdJsonPlayer(e,t,s,{onstart:function(e){o._adjustSize(),void 0!==o.options.onstart&&o.options.onstart(e)},onload:function(e){void 0!==o.options.onload&&o.options.onload(e)},onrender:function(e){o._onUpdate(e),void 0!==o.options.onrender&&o.options.onrender(e)},onplay:function(e){o.ui.play.show=!1,o.ui.step.disabled||(o.ui.step.show=!1),o.ui.pause.show=!0},onstop:function(e){o.ui.play.show=!0,o.ui.step.disabled||(o.ui.step.show=!0),o.ui.pause.show=!1},onfinish:function(e){},onerror:function(e){console.log(e)}})}_onUpdate(e){const t=this;if(void 0!==t.ui){if(void 0!==t.ui.frames&&(t.ui.frames.text=t.player.currentFrame()+1+"/"+t.player.totalFrames()),void 0!==t.ui.lapse){let s="";const o=t.player._startTimeStamp&&void 0!==e.ts,a=void 0!==e.t,i=t.player._totTime>0;e.d&&(s=e.d+" "),o?s+=t._formatMillis(e.ts-t.player._startTimeStamp):a&&(s+=e.t.indexOf(":")>0?e.t:t._fmtTime(e.t)),i&&(s+="/"+t.player.totalTime()),t.ui.lapse.text=s}void 0!==t.ui.progress&&(t.ui.progress.value=(t.player.currentFrame()+1)/t.player.totalFrames()*100)}}_adjustSize(){if(this.options.resize){let e=this.player.wrapper,t=e.parent();if(e.clientHeight>t.clientHeight){let s=this.player.canvas.height/this.player.canvas.width,o=1/s;this.player.canvas.height=t.clientHeight-(this.options.controls?e.querySelector(".panel").clientHeight:0),this.player.canvas.width=t.clientWidth*(s<1?s:o)}}}_create(e){const t=this,s=m2d2.load();t.ui=s(e,t._getUI(e)),["thumb","play","step","pause","stop","lapse","progress","frames","fullscreen"].forEach((e=>{t.ui[e]=t.ui.panel[e]}))}_getUI(e){const t=this;let s={html:e.innerHTML||""};if(t.options.controls){const e="full"===t.options.controls,o="common"===t.options.controls;s=this._getBasicUI(),e&&(s.panel.stop.show=!0,s.panel.lapse.show=!0,s.panel.step.disabled=!1,s.panel.frames.show=!0,s.panel.fullscreen.show=!0),o&&(s.panel.frames.show=!0)}this.options.controls;let o=e instanceof Node?e:document.querySelector(e);if(o){o.querySelector("canvas")||(s=Object.assign({canvas:""},s))}else console.log("Root element: "+e+" was not found in document"),s=Object.assign({canvas:""},s);return s}_getBasicUI(){const e=this;return document.addEventListener("fullscreenchange",(t=>{const s=e.player.wrapper;document.fullscreenElement?s.classList.add("fullscreen"):s.classList.remove("fullscreen")})),{caption:"",panel:{tagName:"div",className:"panel",thumb:{tagName:"figure",className:"thumb",show:!1,img:{src:""},caption:{tagName:"figCaption",className:"caption",show:!1}},play:{tagName:"a",className:"play",title:"Play",href:"#",show:!0,onclick:function(){return e.ui.onaction("play",e.player,e),e.player.play(),!1}},pause:{tagName:"a",className:"pause",title:"Pause",href:"#",show:!1,onclick:function(){return e.ui.onaction("pause",e.player,e),e.player.pause(),!1}},step:{tagName:"a",className:"step",title:"Step",href:"#",disabled:!0,show:!1,onclick:function(){return e.ui.onaction("step",e.player,e),e.player.step(),!1}},stop:{tagName:"a",className:"stop",title:"Stop",href:"#",show:!1,onclick:function(){return e.ui.onaction("stop",e.player,e),e.player.stop(),!1}},lapse:{tagName:"label",className:"lapse",title:"Time elapsed / Time Total",text:"0:00",show:!1},progress:{value:0,max:100,show:!0,onmousemove:function(t){let s=~~(t.offsetX/this.offsetWidth*100),o=e.player.frameAt(e.player.indexAt(s));o?(e.ui.thumb.show=!0,e.ui.thumb.img.src=e.player.frameBase()+(o.th||o.f),e.ui.thumb.img.onload=function(){const t=e.ui.thumb.img.naturalWidth||e.ui.thumb.img.width;e.ui.thumb.style.width=t+"px"},void 0!==o.tc&&(e.ui.thumb.caption=o.tc),e.ui.thumb.style.left=this.offsetLeft+t.offsetX-e.ui.thumb.clientWidth/2+"px"):e.ui.thumb.show=!1},onmouseleave:function(){e.ui.thumb.show=!1},onclick:function(t){let s=~~(t.offsetX/this.offsetWidth*100),o=e.player.indexAt(s);e.player.step(o),e.ui.onaction("progress",e.player,e)}},frames:{tagName:"label",className:"frames",title:"Current Frame / Total Frames",text:"0",show:!1},fullscreen:{tagName:"a",className:"fullscreen",title:"Full Screen",href:"#",show:!1,onclick:function(t){const s=e.player.wrapper;return s.classList.contains("fullscreen")?(e.ui.onaction("exit-fullscreen",e.player,e),document.exitFullscreen()):(e.ui.onaction("fullscreen",e.player,e),s.requestFullscreen()),!1}}},onaction:function(t,s,o){e.options.onaction(t,s,o)}}}_fmtTime(e){let t=(e=e.toFixed(2)).split(".")[1]||"00";return(~~(e/60)+"").padStart(2,"0")+":"+(~~(e/60%1*60)+"").padStart(2,"0")+"."+t}_formatMillis(e){function t(e,t){return("00"+e).slice(-1*(t||2))}const s=Math.floor(e/1e3/60/60),o=Math.floor(60*(e/1e3/60/60-s)),a=Math.floor(60*(60*(e/1e3/60/60-s)-o)),i=parseInt(e%1e3/100);return t(s)+":"+t(o)+":"+t(a)+"."+t(i,3)}}
//# sourceMappingURL=ndjson-ui.min.js.map
